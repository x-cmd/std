
x log init param
param_log info "copy all files from ./* to ~/.x-cmd/param/"
x ws install

dbash() {
    docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd "bash:$1" \
        bash -c "printf \". ~/.x-cmd/xrc/latest && . ./testcase/v0_test_awk\" >/root/.bashrc && cd pd && bash"
}

cross_env_test() {
    for i in bash:3 bash:4 bash:5 ; do
        param_log info "Testing : " "$i"
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd "${i}" bash -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test"
    done

    for i in alpine ubuntu ; do
        param_log info "Testing : " "$i"
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd "${i}" sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test"
    done
}

param_log info "Testing : $1"
case "$1" in
    local)
        . ./testcase/v0_test
        ;;
    cross)
        x test local
        cross_env_test
        ;;
    bash:3|bash:4|bash:5)
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd "$1" bash -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test"
        ;;
    alpine|ubuntu)
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd "$1" sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test"
        ;;
    *)
        echo "Usage: x test {cross|local|bash:3|bash:4|bash:5|alpine|ubuntu}"
        return 1
        ;;
esac