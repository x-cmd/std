# shellcheck shell=sh disable=SC1072 #source

dbash() {
    docker run -it -v "$(pwd)":/pd "xcmd/bash${1}-dev" bash -i -c "cd pd && bash"
}

cross_env_test() {
    for i in bash3 bash4 bash5 ; do
        param_log info "Testing : " "$i"
        docker run -it -v "$(pwd)":/pd "xcmd/${i}-dev" bash -i -c "cd pd && x test local"
    done

    for i in alpine ubuntu centos ; do
        param_log info "Testing : " "$i"
        docker run -it -v "$(pwd)":/pd "xcmd/${i}-dev" sh -i -c "cd pd && x test local"
    done
}

x log init param
param_log info "Testing : $1"
case "$1" in
    local)
        param_log info "copy all files from ./* to ~/.x-cmd/param/"
        \cp -r ./* ~/.x-cmd/param/
        # xws install
        . "$(x wsroot)/.x-cmd/testcases/v0_test"
        ;;
    cross)
        x test local
        cross_env_test
        ;;
    bash3|bash4|bash5|centos)
        docker run -it -v "$(pwd)":/pd "xcmd/${1}-dev" bash -i -c "cd pd && x test local"
        ;;
    alpine|ubuntu)
        docker run -it -v "$(pwd)":/pd "xcmd/${1}-dev" sh -i -c "cd pd && . \$(x wsroot)/.x-cmd/testcases/v0_test"
        ;;
    help)
        x test local
        . "$(x wsroot)/.x-cmd/testcases/v0_test_help"
        start_test "$(x wsroot)/.x-cmd/testcases/v0_test_help"
        ;;
    *)
        xws install
        echo "Usage: x test {cross|local|bash3|bash4|bash5|alpine|ubuntu|centos}"
        return 1
        ;;
esac