#! /usr/bin/env xsh


lsmod_getfp(){
    local filename=modlist
    local fp="$(pwd)/$filename"
    [ -f "$fp" ] && printf "%s" "$fp" && return

    fp="$(x wsroot)/$filename"
    [ -f "$fp" ] && printf "%s" "$fp" && return

    return 1
}

lsmod(){
    local fp
    fp="$(lsmod_getfp)" || {
        printf "Cannot find file modlist." >&3
        return
    }

    awk -v mode="${1:-all}" '
($0!="")&&($0 !~ /[ ]*#/){
    mod=$1
    gsub(/^\+/, "", mod)
    if (mode == "all") print mod
    else if (mode == "core") { if ($1 ~ /^\+/) print mod }
    else if (index(mode, mod) > 0) print mod
}' <"$fp"

}

lsmod "$@"
