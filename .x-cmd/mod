#! /usr/bin/env bash

add(){
    local name="${1:?Provide module name}"
    # local position="${2:-"git@gitee.com/x-bash/$name.git"}"
    local position="${2:-"https://gitee.com/x-bash/$name.git"}"
    local branch="${3:-master}"
    git subtree add --prefix="lib/$name" "$position" "$branch" --squash
}

pull(){
    local name="${1:?Provide module name}"
    # local position="${2:-"git@gitee.com/x-bash/$name.git"}"
    local position="${2:-"https://gitee.com/x-bash/$name.git"}"
    local branch="${3:-master}"
    git subtree pull --prefix="lib/$name" "$position" "$branch" --squash
}

all(){
    local mod_list=(
        str
        list
        assert

        dict
        http
        param
        advise
        ui

        static-build

        ccmd

        ali
        gitee
    )
    for mod in "${mod_list[@]}"; do
        if [ -e "lib/$mod" ]; then
            pull "$mod"
        else
            add "$mod"
        fi
    done
}

if [ "$#" -gt 0 ]; then
    op="$1"
    shift
    "$op" "$@"
fi
