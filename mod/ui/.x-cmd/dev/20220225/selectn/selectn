
# shellcheck shell=sh disable=SC3043

# author:       Li Junhao           l@x-cmd.com

# . ./lib/region
xrc ui/lib/region
xrc ui/lib/getchar

___x_cmd_ui_selectn_control_awk(){
    LC_ALL=en_US.UTF-8 command awk \
        -v EXIT_OP="$EXIT_OP" \
        -v RS="$___X_CMD_UI_REGION_RS" -v ORS="$___X_CMD_UI_REGION_RS" \
        -f "$___X_CMD_ROOT/awk/lib/default.awk" \
        -f "$___X_CMD_ROOT/awk/lib/str.awk" \
        -f "$___X_CMD_ROOT/awk/lib/wcwidth.awk" \
        -f "$___X_CMD_ROOT/awk/lib/ui.awk" \
        -f "./lib/share.awk" \
        -f "./lib/selectn.awk" \
        -f "./lib/theme.awk"
}

___x_cmd_ui_selectn_control_display(){
    cat "./lib/selectndata" | command awk -v REGION_RS="$___X_CMD_UI_REGION_RS" '{printf $0 REGION_RS}'
    # cat "./.x-cmd/dev/testcase/testlargedata" | awk -v REGION_RS="$___X_CMD_UI_REGION_RS" '{printf $0 REGION_RS}'
}

___x_cmd_ui_selectn_control(){
    {
        "$@" | ___x_cmd_ui_region_send_update
        cat
    } | ___x_cmd_ui_selectn_control_awk
}
___ui_selectn_out_func(){
    ___x_cmd_ui_region_autorefresh_with_keyboard ___x_cmd_ui_selectn_control "$@"
}
___ui_selectn_out(){
    ___ui_selectn_out_func ___x_cmd_ui_selectn_control_display
}
# # ___ui_selectn_out

# echo "___X_CMD_UI_SELECTN_FINAL_COMMAND:" "$___X_CMD_UI_SELECTN_FINAL_COMMAND"
# echo "___X_CMD_UI_SELECTN_CURRENT_ITEM:" "$___X_CMD_UI_SELECTN_CURRENT_ITEM"
