# shellcheck shell=sh disable=SC3043

##################
## Test functions
##################
xrc proxy

test_run() {
    proxy_log info "Testing apt set: "
    x proxy apt set

    proxy_log info "Testing apt update: "
    apt-get update
    apt-get install -y curl

    proxy_log info "Testing apt unset: "
    x proxy apt unset

    proxy_log info "Testing apt update: "
    apt-get update
    apt-get install -y nano
}

test_different_version_for_debian(){
    for i in sid testing bullseye buster stretch jessie ; do
        proxy_log info "Testing : " "debian:$i"
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd debian:"${i}" sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test_apt && test_run"
        proxy_log info "Testing : " "amd64/debian:$i"
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd amd64/debian:"${i}" sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test_apt && test_run"
    done
}

test_different_version_for_ubuntu(){
    # TODO: There is some problem in ubuntu:12.04
    for i in $(seq -w 14 2 21); do
        proxy_log info "Testing : " "ubuntu:$i.04"
        # docker run -it -v "$(pwd)":/pd amd64/ubuntu:"${i}".04 sh -c "cd pd && . ./testcase/v0_test_apt && test_run"
        # TODO: To remove curl require
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd ubuntu:"${i}".04 sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test_apt && test_run"
        proxy_log info "Testing : " "amd64/ubuntu:$i.04"
        docker run -it -v  ~/.x-cmd/:/root/.x-cmd/ -v "$(pwd)":/pd amd64/ubuntu:"${i}".04 sh -c ". ~/.x-cmd/xrc/latest && cd pd && . ./testcase/v0_test_apt && test_run"
    done
}